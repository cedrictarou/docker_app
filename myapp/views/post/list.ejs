<!DOCTYPE html>
<html lang="ja" class="h-100">

<head>
  <title>
    All Posts
  </title>
  <!-- cssの読み込み -->
  <%- include('../_share/stylesheets.ejs') %>
</head>

<body class="d-flex flex-column h-100">
  <header>
    <%- include('../_share/navbar.ejs') %>
  </header>

  <!-- Begin page content -->
  <main role="main" class="flex-shrink-0">
    <div class="container">
      <div class="mb-5">
        <h2>みんなの投稿</h2>
      </div>
      <% if (posts) { %>
        <% posts.forEach( post=> { %>
          <div class="card mb-3">
            <div class="card-body">
              <h3 class="card-title">
                <%= post.title %>
              </h3>
              <p class="card-text">
                <%= post.content %>
              </p>
              <div class="post-user">
                <span><i class="fas fa-user"></i>
                  <span>
                    <%= post.User.username %>
                  </span>
              </div>
              <div class="heart_icon">
                <span><i class="far fa-heart"></i> </span></i><span>2</span>
              </div>
              <div class="mt-3">
                <!-- ログインしているユーザーの投稿だけ編集削除できるようにする -->
                <% const postId=post.id %>
                  <% if (locals.user.id===post.user_id) { %>
                    <form>
                      <button class="btn btn-primary" type="submit" data-action="/post/edit/<%= postId %>"
                        data-method="get">編集</button>
                      <button class="btn btn-danger" type="submit"
                        data-action="/post/delete/<%= postId %>?_method=DELETE" data-method="post">削除</button>
                    </form>
                    <% } %>
              </div>
            </div>
          </div>
          <% }) %>
            <% } %>

    </div>
  </main>

  <%- include('../_share/footer.ejs') %>
    <%- include('../_share/javascripts.ejs') %>
      <script src="/javascripts/post/edit.js"></script>
</body>

</html>